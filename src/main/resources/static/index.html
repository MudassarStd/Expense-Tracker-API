<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Expense Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
          font-family: 'Inter', sans-serif;
          margin: 0;
          background: #f4f6f8;
          color: #333;
        }
        .container {
          max-width: 900px;
          margin: auto;
          padding: 2rem;
        }
        h1, h2 {
          color: #2c3e50;
        }
        .form-section, .expenses-section {
          background: #fff;
          padding: 2rem;
          margin-top: 2rem;
          border-radius: 12px;
          box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }
        .filter-section {
          position: relative;
          margin-top: 2rem;
          text-align: right;
        }
        .filter-toggle {
          background: #2c3e50;
          color: white;
          border: none;
          padding: 0.8rem 1.5rem;
          border-radius: 8px;
          font-size: 1rem;
          cursor: pointer;
          display: inline-flex;
          align-items: center;
          gap: 0.5rem;
        }
        .filter-form {
          display: none;
          flex-wrap: wrap;
          gap: 0.8rem;
          margin-top: 1rem;
          justify-content: flex-start;
          background: #fff;
          padding: 1rem;
          border-radius: 12px;
          box-shadow: 0 2px 12px rgba(0,0,0,0.05);
        }
        .filter-form.active {
          display: flex;
        }
        .chip {
          border: 1px solid #ccc;
          border-radius: 20px;
          padding: 0.4rem 1rem;
          background: #f9f9f9;
          display: flex;
          align-items: center;
          gap: 0.4rem;
        }
        .chip input, .chip select {
          border: none;
          outline: none;
          font-size: 0.9rem;
          background: transparent;
        }
        form {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
          gap: 1rem;
          align-items: end;
        }
        input, select, button {
          padding: 0.7rem;
          border: 1px solid #ccc;
          border-radius: 8px;
          font-size: 1rem;
        }
        button {
          background: #2c3e50;
          color: #fff;
          cursor: pointer;
          transition: background 0.3s;
        }
        button:hover {
          background: #34495e;
        }
        .expenses-table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 1rem;
        }
        .expenses-table th {
          background: #2c3e50;
          color: white;
          padding: 1rem;
          text-align: left;
        }
        .expenses-table td {
          padding: 1rem;
          border-bottom: 1px solid #eee;
        }
        .expenses-table tr:hover {
          background-color: #f5f5f5;
        }
        .expense-amount {
          font-weight: 600;
        }
        .type-expense {
          color: #e74c3c;
        }
        .type-income {
          color: #27ae60;
        }
        .category-tag {
          background: #ecf0f1;
          padding: 0.3rem 0.8rem;
          border-radius: 20px;
          font-size: 0.9em;
          display: inline-block;
        }
        .action-icons i {
          cursor: pointer;
          margin-right: 0.5rem;
          color: #3498db;
        }
        .action-icons i:hover {
          color: #1d6fa5;
        }
    </style>
</head>
<body>
<div class="container">
    <h1><i class="fas fa-wallet"></i> Expense Tracker</h1>

    <section class="form-section">
        <h2>Add New Expense</h2>
        <form id="expenseForm">
            <input type="number" name="amount" placeholder="Amount" required />
            <input type="text" name="description" placeholder="Description" required />
            <select name="category" required>
                <option value="">Select Category</option>
                <option value="FOOD">Food</option>
                <option value="TRAVEL">Travel</option>
                <option value="HEALTH">Health</option>
                <option value="UTILITIES">Utilities</option>
                <option value="ENTERTAINMENT">Entertainment</option>
                <option value="OTHERS">Others</option>
            </select>
            <select name="type" required>
                <option value="">Select Type</option>
                <option value="EXPENSE">Expense</option>
                <option value="INCOME">Income</option>
            </select>
            <input type="date" name="date" required />
            <button type="submit"><i class="fas fa-plus-circle"></i> Add</button>
        </form>
    </section>

    <section class="filter-section">
        <button class="filter-toggle" onclick="toggleFilters()">
            <i class="fas fa-filter"></i> Filters
        </button>
        <form id="filterForm" class="filter-form">
            <div class="chip">Min ₹<input type="number" name="minAmount" placeholder="0" /></div>
            <div class="chip">Max ₹<input type="number" name="maxAmount" placeholder="1000" /></div>
            <div class="chip">
                Category
                <select name="category">
                    <option value="">All</option>
                    <option value="FOOD">Food</option>
                    <option value="TRAVEL">Travel</option>
                    <option value="HEALTH">Health</option>
                    <option value="UTILITIES">Utilities</option>
                    <option value="ENTERTAINMENT">Entertainment</option>
                    <option value="OTHERS">Others</option>
                </select>
            </div>
            <div class="chip">
                Type
                <select name="type">
                    <option value="">All</option>
                    <option value="EXPENSE">Expense</option>
                    <option value="INCOME">Income</option>
                </select>
            </div>
            <div class="chip">From<input type="date" name="startDate" /></div>
            <div class="chip">To<input type="date" name="endDate" /></div>
            <button type="submit" class="chip"><i class="fas fa-check"></i> Apply</button>
        </form>
    </section>

    <section class="expenses-section">
        <h2>All Expenses</h2>
        <table class="expenses-table">
            <thead>
            <tr>
                <th>Amount</th>
                <th>Description</th>
                <th>Category</th>
                <th>Type</th>
                <th>Date</th>
                <th>Action</th>
            </tr>
            </thead>
            <tbody id="expenses">
            <!-- Data will be inserted here -->
            </tbody>
        </table>
    </section>
</div>

<!--<script>-->
<!--    function toggleFilters() {-->
<!--      document.getElementById('filterForm').classList.toggle('active');-->
<!--    }-->

<!--    async function fetchExpenses(params = '') {-->
<!--      const dummyData = [-->
<!--        { amount: 250, description: 'Groceries', category: 'FOOD', type: 'EXPENSE', date: '2025-04-15' },-->
<!--        { amount: 500, description: 'Salary', category: 'OTHERS', type: 'INCOME', date: '2025-04-10' },-->
<!--        { amount: 100, description: 'Gym', category: 'HEALTH', type: 'EXPENSE', date: '2025-04-12' },-->
<!--        { amount: 75, description: 'Bus Ticket', category: 'TRAVEL', type: 'EXPENSE', date: '2025-04-14' },-->
<!--        { amount: 300, description: 'Movie Night', category: 'ENTERTAINMENT', type: 'EXPENSE', date: '2025-04-13' }-->
<!--      ];-->

<!--      const container = document.getElementById('expenses');-->
<!--      container.innerHTML = '';-->
<!--      dummyData.forEach(exp => {-->
<!--        const row = document.createElement('tr');-->
<!--        row.innerHTML = `-->
<!--          <td class="expense-amount ${exp.type === 'EXPENSE' ? 'type-expense' : 'type-income'}">₹${exp.amount}</td>-->
<!--          <td>${exp.description}</td>-->
<!--          <td><span class="category-tag">${exp.category}</span></td>-->
<!--          <td>${exp.type}</td>-->
<!--          <td>${exp.date}</td>-->
<!--          <td class="action-icons">-->
<!--            <i class="fas fa-edit" title="Edit"></i>-->
<!--            <i class="fas fa-trash" title="Delete"></i>-->
<!--          </td>-->
<!--        `;-->
<!--        container.appendChild(row);-->
<!--      });-->
<!--    }-->

<!--    document.getElementById('expenseForm').addEventListener('submit', async (e) => {-->
<!--      e.preventDefault();-->
<!--      const formData = new FormData(e.target);-->
<!--      const data = Object.fromEntries(formData);-->
<!--      await fetch('/expense', {-->
<!--        method: 'POST',-->
<!--        headers: { 'Content-Type': 'application/json' },-->
<!--        body: JSON.stringify(data)-->
<!--      });-->
<!--      e.target.reset();-->
<!--      fetchExpenses();-->
<!--    });-->

<!--    document.getElementById('filterForm').addEventListener('submit', async (e) => {-->
<!--      e.preventDefault();-->
<!--      const formData = new FormData(e.target);-->
<!--      const params = new URLSearchParams();-->
<!--      for (const [key, value] of formData.entries()) {-->
<!--        if (value) params.append(key, value);-->
<!--      }-->
<!--      fetchExpenses('?' + params.toString());-->
<!--    });-->

<!--    fetchExpenses();-->
<!--</script>-->

<script>
    let editingId = null;

    function toggleFilters() {
      document.getElementById('filterForm').classList.toggle('active');
    }

    async function fetchExpenses(params = '') {
      const res = await fetch('/expense' + params);
      const data = await res.json();

      const container = document.getElementById('expenses');
      container.innerHTML = '';
      data.forEach(exp => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td class="expense-amount ${exp.type === 'EXPENSE' ? 'type-expense' : 'type-income'}">₹${exp.amount}</td>
          <td>${exp.description}</td>
          <td><span class="category-tag">${exp.category}</span></td>
          <td>${exp.type}</td>
          <td>${exp.date}</td>
          <td class="action-icons">
            <i class="fas fa-edit" title="Edit" onclick="editExpense(${exp.id})"></i>
            <i class="fas fa-trash" title="Delete" onclick="deleteExpense(${exp.id})"></i>
          </td>
        `;
        container.appendChild(row);
      });
    }

    document.getElementById('expenseForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData);

      data.amount = parseFloat(data.amount);
      data.date = new Date(data.date).toISOString().split('T')[0];

      const url = editingId ? `/expense/update/${editingId}` : '/expense';
      const method = editingId ? 'PUT' : 'POST';

      await fetch(url, {
        method,
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      editingId = null;
      e.target.reset();
      fetchExpenses();
    });

    document.getElementById('filterForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const params = new URLSearchParams();
      for (const [key, value] of formData.entries()) {
        if (value) params.append(key, value);
      }
      fetchExpenses('?' + params.toString());
    });

    async function deleteExpense(id) {
      if (!confirm("Are you sure you want to delete this expense?")) return;

      await fetch(`/expense/delete/${id}`, {
        method: 'DELETE'
      });

      fetchExpenses();
    }

    function editExpense(id) {
      fetch(`/expense/find/${id}`)
        .then(res => res.json())
        .then(exp => {
          const form = document.getElementById('expenseForm');
          form.amount.value = exp.amount;
          form.description.value = exp.description;
          form.category.value = exp.category;
          form.type.value = exp.type;
          form.date.value = exp.date;
          editingId = exp.id;
        });
    }

    // Initial load
    fetchExpenses();
</script>

</body>
</html>